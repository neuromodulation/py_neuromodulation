<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ECoG Movement decoding example &mdash; py_neuromodulation  documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
        <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="ParametrizationDefinition" href="param.html" />
    <link rel="prev" title="First Demo" href="first_demo.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="index.html" class="icon icon-home"> py_neuromodulation
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="introduction.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="examples.html">Examples</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="first_demo.html">First Demo</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">ECoG Movement decoding example</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#Featue-Analysis">Featue Analysis</a></li>
<li class="toctree-l3"><a class="reference internal" href="#Decoding">Decoding</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="param.html">ParametrizationDefinition</a></li>
<li class="toctree-l2"><a class="reference internal" href="example_gridPointProjection.html">Grid Point Projection</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Code Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="outline_parametrization.html">Parametrization</a></li>
<li class="toctree-l1"><a class="reference internal" href="outline_featureestimation.html">Feature Estimation</a></li>
<li class="toctree-l1"><a class="reference internal" href="outline_analysis.html">Analysis</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">py_neuromodulation</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home"></a></li>
          <li class="breadcrumb-item"><a href="examples.html">Examples</a></li>
      <li class="breadcrumb-item active">ECoG Movement decoding example</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/example_BIDS.ipynb.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars and line breaks on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
    white-space: pre;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}

/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<section id="ECoG-Movement-decoding-example">
<h1>ECoG Movement decoding example<a class="headerlink" href="#ECoG-Movement-decoding-example" title="Permalink to this heading"></a></h1>
<p>This example notebook read openly accessible data from the publication <em>Electrocorticography is superior to subthalamic local field potentials for movement decoding in Parkinson’s disease</em> (<a class="reference external" href="https://elifesciences.org/articles/75126">Merk et al. 2022</a>). The dataset is available <a class="reference external" href="https://doi.org/10.7910/DVN/IO2FLM">here</a>.</p>
<p>For simplicity one example subject is automatically shipped within this repo at the <em>examples/data</em> folder, stored in <a class="reference external" href="https://www.nature.com/articles/s41597-019-0105-7">iEEG BIDS</a> format.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">py_neuromodulation</span> <span class="k">as</span> <span class="nn">nm</span>
<span class="kn">from</span> <span class="nn">py_neuromodulation</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">nm_analysis</span><span class="p">,</span>
    <span class="n">nm_decode</span><span class="p">,</span>
    <span class="n">nm_define_nmchannels</span><span class="p">,</span>
    <span class="n">nm_IO</span><span class="p">,</span>
    <span class="n">nm_plots</span><span class="p">,</span>
    <span class="n">nm_settings</span><span class="p">,</span>
    <span class="n">nm_stats</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">sklearn</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">metrics</span><span class="p">,</span>
    <span class="n">model_selection</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">xgboost</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">os</span>
<br/></pre></div>
</div>
</div>
<p>Let’s read the example using <a class="reference external" href="https://mne.tools/mne-bids/stable/index.html">mne_bids</a>. The resulting raw object in of type <a class="reference external" href="https://mne.tools/stable/generated/mne.io.RawArray.html">mne.RawArray</a>. We can use the properties such as sampling frequency, channel names, channel types all from the mne array and create the <em>nm_channels</em> dataframe:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">RUN_NAME</span><span class="p">,</span> <span class="n">PATH_RUN</span><span class="p">,</span> <span class="n">PATH_BIDS</span><span class="p">,</span> <span class="n">PATH_OUT</span><span class="p">,</span> <span class="n">datatype</span> <span class="o">=</span> <span class="n">nm_IO</span><span class="o">.</span><span class="n">get_paths_example_data</span><span class="p">()</span>

<span class="p">(</span>
    <span class="n">raw</span><span class="p">,</span>
    <span class="n">data</span><span class="p">,</span>
    <span class="n">sfreq</span><span class="p">,</span>
    <span class="n">line_noise</span><span class="p">,</span>
    <span class="n">coord_list</span><span class="p">,</span>
    <span class="n">coord_names</span><span class="p">,</span>
<span class="p">)</span> <span class="o">=</span> <span class="n">nm_IO</span><span class="o">.</span><span class="n">read_BIDS_data</span><span class="p">(</span>
    <span class="n">PATH_RUN</span><span class="o">=</span><span class="n">PATH_RUN</span><span class="p">,</span> <span class="n">BIDS_PATH</span><span class="o">=</span><span class="n">PATH_BIDS</span><span class="p">,</span> <span class="n">datatype</span><span class="o">=</span><span class="n">datatype</span>
<span class="p">)</span>

<span class="n">nm_channels</span> <span class="o">=</span> <span class="n">nm_define_nmchannels</span><span class="o">.</span><span class="n">set_channels</span><span class="p">(</span>
    <span class="n">ch_names</span><span class="o">=</span><span class="n">raw</span><span class="o">.</span><span class="n">ch_names</span><span class="p">,</span>
    <span class="n">ch_types</span><span class="o">=</span><span class="n">raw</span><span class="o">.</span><span class="n">get_channel_types</span><span class="p">(),</span>
    <span class="n">reference</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">bads</span><span class="o">=</span><span class="n">raw</span><span class="o">.</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;bads&quot;</span><span class="p">],</span>
    <span class="n">new_names</span><span class="o">=</span><span class="s2">&quot;default&quot;</span><span class="p">,</span>
    <span class="n">used_types</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;ecog&quot;</span><span class="p">,</span> <span class="s2">&quot;dbs&quot;</span><span class="p">,</span> <span class="s2">&quot;seeg&quot;</span><span class="p">),</span>
    <span class="n">target_keywords</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;MOV_RIGHT_CLEAN&quot;</span><span class="p">,</span><span class="s2">&quot;MOV_LEFT_CLEAN&quot;</span><span class="p">]</span>
<span class="p">)</span>

<span class="n">nm_channels</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Extracting parameters from /Users/hi/Documents/py_neuromodulation/examples/data/sub-000/ses-right/ieeg/sub-000_ses-right_task-force_run-3_ieeg.vhdr...
Setting channel info structure...
Reading channel info from /Users/hi/Documents/py_neuromodulation/examples/data/sub-000/ses-right/ieeg/sub-000_ses-right_task-force_run-3_channels.tsv.
Reading electrode coords from /Users/hi/Documents/py_neuromodulation/examples/data/sub-000/ses-right/ieeg/sub-000_ses-right_space-mni_electrodes.tsv.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>rereference</th>
      <th>used</th>
      <th>target</th>
      <th>type</th>
      <th>status</th>
      <th>new_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>LFP_RIGHT_0</td>
      <td>LFP_RIGHT_2</td>
      <td>1</td>
      <td>0</td>
      <td>seeg</td>
      <td>good</td>
      <td>LFP_RIGHT_0-LFP_RIGHT_2</td>
    </tr>
    <tr>
      <th>1</th>
      <td>LFP_RIGHT_1</td>
      <td>LFP_RIGHT_0</td>
      <td>1</td>
      <td>0</td>
      <td>seeg</td>
      <td>good</td>
      <td>LFP_RIGHT_1-LFP_RIGHT_0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>LFP_RIGHT_2</td>
      <td>LFP_RIGHT_1</td>
      <td>1</td>
      <td>0</td>
      <td>seeg</td>
      <td>good</td>
      <td>LFP_RIGHT_2-LFP_RIGHT_1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>ECOG_RIGHT_0</td>
      <td>average</td>
      <td>1</td>
      <td>0</td>
      <td>ecog</td>
      <td>good</td>
      <td>ECOG_RIGHT_0-avgref</td>
    </tr>
    <tr>
      <th>4</th>
      <td>ECOG_RIGHT_1</td>
      <td>average</td>
      <td>1</td>
      <td>0</td>
      <td>ecog</td>
      <td>good</td>
      <td>ECOG_RIGHT_1-avgref</td>
    </tr>
    <tr>
      <th>5</th>
      <td>ECOG_RIGHT_2</td>
      <td>average</td>
      <td>1</td>
      <td>0</td>
      <td>ecog</td>
      <td>good</td>
      <td>ECOG_RIGHT_2-avgref</td>
    </tr>
    <tr>
      <th>6</th>
      <td>ECOG_RIGHT_3</td>
      <td>average</td>
      <td>1</td>
      <td>0</td>
      <td>ecog</td>
      <td>good</td>
      <td>ECOG_RIGHT_3-avgref</td>
    </tr>
    <tr>
      <th>7</th>
      <td>ECOG_RIGHT_4</td>
      <td>average</td>
      <td>1</td>
      <td>0</td>
      <td>ecog</td>
      <td>good</td>
      <td>ECOG_RIGHT_4-avgref</td>
    </tr>
    <tr>
      <th>8</th>
      <td>ECOG_RIGHT_5</td>
      <td>average</td>
      <td>1</td>
      <td>0</td>
      <td>ecog</td>
      <td>good</td>
      <td>ECOG_RIGHT_5-avgref</td>
    </tr>
    <tr>
      <th>9</th>
      <td>MOV_RIGHT</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>misc</td>
      <td>good</td>
      <td>MOV_RIGHT</td>
    </tr>
    <tr>
      <th>10</th>
      <td>MOV_LEFT</td>
      <td>None</td>
      <td>0</td>
      <td>0</td>
      <td>misc</td>
      <td>good</td>
      <td>MOV_LEFT</td>
    </tr>
    <tr>
      <th>11</th>
      <td>MOV_RIGHT_CLEAN</td>
      <td>None</td>
      <td>0</td>
      <td>1</td>
      <td>misc</td>
      <td>good</td>
      <td>MOV_RIGHT_CLEAN</td>
    </tr>
    <tr>
      <th>12</th>
      <td>MOV_LEFT_CLEAN</td>
      <td>None</td>
      <td>0</td>
      <td>1</td>
      <td>misc</td>
      <td>good</td>
      <td>MOV_LEFT_CLEAN</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>This example contains the force grip movement traces, we’ll use the <em>MOV_RIGHT_CLEAN</em> channel as a decoding target channel. Let’s check some of the raw feature and time series traces:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">121</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="p">:])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;a.u.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Movement label&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">122</span><span class="p">)</span>
<span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">ch_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nm_channels</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;used == 1&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">name</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">raw</span><span class="o">.</span><span class="n">times</span><span class="p">,</span> <span class="n">data</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="p">:]</span> <span class="o">+</span> <span class="n">idx</span><span class="o">*</span><span class="mi">300</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">ch_name</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;center left&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;ECoG + STN-LFP time series&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Time [s]&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Voltage a.u.&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
(0.0, 20.0)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_BIDS_5_1.png" src="_images/example_BIDS_5_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">nm_settings</span><span class="o">.</span><span class="n">get_default_settings</span><span class="p">()</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">nm_settings</span><span class="o">.</span><span class="n">set_settings_fast_compute</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>

<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="s2">&quot;fft&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="s2">&quot;bursts&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="s2">&quot;sharpwave_analysis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;features&quot;</span><span class="p">][</span><span class="s2">&quot;coherence&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;coherence&quot;</span><span class="p">][</span><span class="s2">&quot;channels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span>
        <span class="s2">&quot;LFP_RIGHT_0&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ECOG_RIGHT_0&quot;</span>
    <span class="p">]</span>
<span class="p">]</span>
<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;coherence&quot;</span><span class="p">][</span><span class="s2">&quot;frequency_bands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;high beta&quot;</span><span class="p">,</span>
    <span class="s2">&quot;low gamma&quot;</span>
<span class="p">]</span>
<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;sharpwave_analysis_settings&quot;</span><span class="p">][</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">sw_feature</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span>
    <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;sharpwave_analysis_settings&quot;</span><span class="p">][</span><span class="s2">&quot;sharpwave_features&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
<span class="p">):</span>
    <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;sharpwave_analysis_settings&quot;</span><span class="p">][</span><span class="s2">&quot;sharpwave_features&quot;</span><span class="p">][</span><span class="n">sw_feature</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">settings</span><span class="p">[</span><span class="s2">&quot;sharpwave_analysis_settings&quot;</span><span class="p">][</span><span class="s2">&quot;estimator&quot;</span><span class="p">][</span><span class="s2">&quot;mean&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sw_feature</span><span class="p">)</span>

<span class="c1"># For further notebook demonstration, we will enable here alse the</span>
<span class="c1"># grid point projection.</span>
<span class="n">settings</span><span class="p">[</span><span class="s2">&quot;postprocessing&quot;</span><span class="p">][</span><span class="s2">&quot;project_cortex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stream</span> <span class="o">=</span> <span class="n">nm</span><span class="o">.</span><span class="n">Stream</span><span class="p">(</span>
    <span class="n">sfreq</span><span class="o">=</span><span class="n">sfreq</span><span class="p">,</span>
    <span class="n">nm_channels</span><span class="o">=</span><span class="n">nm_channels</span><span class="p">,</span>
    <span class="n">settings</span><span class="o">=</span><span class="n">settings</span><span class="p">,</span>
    <span class="n">line_noise</span><span class="o">=</span><span class="n">line_noise</span><span class="p">,</span>
    <span class="n">coord_list</span><span class="o">=</span><span class="n">coord_list</span><span class="p">,</span>
    <span class="n">coord_names</span><span class="o">=</span><span class="n">coord_names</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
No data specified. Sanity checks related to the length of the signal relative to the filter order will be skipped.
Setting up band-stop filter

FIR filter parameters
---------------------
Designing a one-pass, zero-phase, non-causal bandstop filter:
- Windowed time-domain design (firwin) method
- Hamming window with 0.0194 passband ripple and 53 dB stopband attenuation
- Lower transition bandwidth: 7.50 Hz
- Upper transition bandwidth: 7.50 Hz
- Filter length: 999 samples (0.999 sec)

</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stream</span><span class="o">.</span><span class="n">run</span><span class="p">(</span>
    <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[:,</span> <span class="p">:</span><span class="nb">int</span><span class="p">(</span><span class="n">sfreq</span><span class="o">*</span><span class="mi">60</span><span class="p">)],</span>
    <span class="n">out_path_root</span><span class="o">=</span><span class="n">PATH_OUT</span><span class="p">,</span>
    <span class="n">folder_name</span><span class="o">=</span><span class="n">RUN_NAME</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
_SIDECAR.json saved to /Users/hi/Documents/py_neuromodulation/examples/data/derivatives/sub-000_ses-right_task-force_run-3/sub-000_ses-right_task-force_run-3_SIDECAR.json
FEATURES.csv saved to /Users/hi/Documents/py_neuromodulation/examples/data/derivatives/sub-000_ses-right_task-force_run-3/sub-000_ses-right_task-force_run-3_FEATURES.csv
settings.json saved to /Users/hi/Documents/py_neuromodulation/examples/data/derivatives/sub-000_ses-right_task-force_run-3/sub-000_ses-right_task-force_run-3_SETTINGS.json
nm_channels.csv saved to /Users/hi/Documents/py_neuromodulation/examples/data/derivatives/sub-000_ses-right_task-force_run-3/sub-000_ses-right_task-force_run-3_nm_channels.csv
</pre></div></div>
</div>
<section id="Featue-Analysis">
<h2>Featue Analysis<a class="headerlink" href="#Featue-Analysis" title="Permalink to this heading"></a></h2>
<p>The obtained performances can now be read and visualized using the <em>nm_analysis.Featuer_Reader</em>.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># init analyzer</span>
<span class="n">feature_reader</span> <span class="o">=</span> <span class="n">nm_analysis</span><span class="o">.</span><span class="n">Feature_Reader</span><span class="p">(</span>
    <span class="n">feature_dir</span><span class="o">=</span><span class="n">PATH_OUT</span><span class="p">,</span> <span class="n">feature_file</span><span class="o">=</span><span class="n">RUN_NAME</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">feature_reader</span><span class="o">.</span><span class="n">label_name</span> <span class="o">=</span> <span class="s2">&quot;MOV_LEFT_CLEAN&quot;</span>
<span class="n">feature_reader</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">feature_reader</span><span class="o">.</span><span class="n">feature_arr</span><span class="p">[</span><span class="s2">&quot;MOV_LEFT_CLEAN&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_reader</span><span class="o">.</span><span class="n">feature_arr</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>LFP_RIGHT_0-LFP_RIGHT_2_fft_theta</th>
      <th>LFP_RIGHT_0-LFP_RIGHT_2_fft_alpha</th>
      <th>LFP_RIGHT_0-LFP_RIGHT_2_fft_low beta</th>
      <th>LFP_RIGHT_0-LFP_RIGHT_2_fft_high beta</th>
      <th>LFP_RIGHT_0-LFP_RIGHT_2_fft_low gamma</th>
      <th>LFP_RIGHT_0-LFP_RIGHT_2_fft_high gamma</th>
      <th>LFP_RIGHT_0-LFP_RIGHT_2_fft_HFA</th>
      <th>LFP_RIGHT_1-LFP_RIGHT_0_fft_theta</th>
      <th>LFP_RIGHT_1-LFP_RIGHT_0_fft_alpha</th>
      <th>LFP_RIGHT_1-LFP_RIGHT_0_fft_low beta</th>
      <th>...</th>
      <th>gridcortex_20_bursts_low gamma_in_burst</th>
      <th>gridcortex_21_bursts_low gamma_in_burst</th>
      <th>gridcortex_23_bursts_low gamma_in_burst</th>
      <th>gridcortex_24_bursts_low gamma_in_burst</th>
      <th>gridcortex_27_bursts_low gamma_in_burst</th>
      <th>gridcortex_28_bursts_low gamma_in_burst</th>
      <th>gridcortex_32_bursts_low gamma_in_burst</th>
      <th>time</th>
      <th>MOV_RIGHT_CLEAN</th>
      <th>MOV_LEFT_CLEAN</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>8.199311</td>
      <td>7.715267</td>
      <td>7.307778</td>
      <td>6.728352</td>
      <td>5.408971</td>
      <td>5.284942</td>
      <td>4.574840</td>
      <td>8.076921</td>
      <td>7.667047</td>
      <td>7.681364</td>
      <td>...</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1000.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>...</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>-1.000000</td>
      <td>1100.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.748604</td>
      <td>-1.241930</td>
      <td>-0.103458</td>
      <td>1.132848</td>
      <td>0.923839</td>
      <td>0.672300</td>
      <td>0.276416</td>
      <td>-0.475502</td>
      <td>-0.012554</td>
      <td>-0.192267</td>
      <td>...</td>
      <td>-0.707107</td>
      <td>-0.707107</td>
      <td>-0.707107</td>
      <td>-0.707107</td>
      <td>-0.707107</td>
      <td>-0.707107</td>
      <td>-0.707107</td>
      <td>1200.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.203481</td>
      <td>-1.381020</td>
      <td>1.326449</td>
      <td>0.008449</td>
      <td>0.315458</td>
      <td>-0.027865</td>
      <td>0.522538</td>
      <td>-0.226624</td>
      <td>1.453535</td>
      <td>1.097820</td>
      <td>...</td>
      <td>-0.577350</td>
      <td>-0.577350</td>
      <td>-0.577350</td>
      <td>-0.577350</td>
      <td>-0.577350</td>
      <td>-0.577350</td>
      <td>-0.577350</td>
      <td>1300.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.687114</td>
      <td>-0.590184</td>
      <td>-0.597682</td>
      <td>0.084082</td>
      <td>0.792506</td>
      <td>-1.059643</td>
      <td>0.254623</td>
      <td>-0.083136</td>
      <td>1.841833</td>
      <td>0.838739</td>
      <td>...</td>
      <td>-0.500000</td>
      <td>-0.500000</td>
      <td>-0.500000</td>
      <td>-0.500000</td>
      <td>-0.500000</td>
      <td>-0.500000</td>
      <td>-0.500000</td>
      <td>1400.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>585</th>
      <td>0.375886</td>
      <td>-0.152099</td>
      <td>-1.118822</td>
      <td>-1.099174</td>
      <td>-1.264676</td>
      <td>-0.763392</td>
      <td>0.576613</td>
      <td>-0.008312</td>
      <td>-0.111578</td>
      <td>0.041051</td>
      <td>...</td>
      <td>1.864836</td>
      <td>1.847096</td>
      <td>1.855363</td>
      <td>1.853519</td>
      <td>1.852705</td>
      <td>1.847096</td>
      <td>1.847096</td>
      <td>59500.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>586</th>
      <td>-0.336085</td>
      <td>-0.465243</td>
      <td>-1.544712</td>
      <td>-0.838877</td>
      <td>-0.191014</td>
      <td>-0.697764</td>
      <td>1.136398</td>
      <td>-0.557561</td>
      <td>-0.377499</td>
      <td>0.011427</td>
      <td>...</td>
      <td>-0.531085</td>
      <td>-0.536240</td>
      <td>-0.533838</td>
      <td>-0.534374</td>
      <td>-0.534610</td>
      <td>-0.536240</td>
      <td>-0.536240</td>
      <td>59600.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>587</th>
      <td>1.809830</td>
      <td>1.932354</td>
      <td>-0.607973</td>
      <td>-1.463207</td>
      <td>-0.010697</td>
      <td>-0.538885</td>
      <td>2.061048</td>
      <td>2.244167</td>
      <td>1.779154</td>
      <td>0.537435</td>
      <td>...</td>
      <td>-0.531085</td>
      <td>-0.536240</td>
      <td>-0.533838</td>
      <td>-0.534374</td>
      <td>-0.534610</td>
      <td>-0.536240</td>
      <td>-0.536240</td>
      <td>59700.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>588</th>
      <td>0.706669</td>
      <td>0.450661</td>
      <td>-1.383534</td>
      <td>-1.780110</td>
      <td>0.085445</td>
      <td>-1.205708</td>
      <td>0.566786</td>
      <td>0.082528</td>
      <td>-0.851844</td>
      <td>-0.202680</td>
      <td>...</td>
      <td>-0.531085</td>
      <td>-0.536240</td>
      <td>-0.533838</td>
      <td>-0.534374</td>
      <td>-0.534610</td>
      <td>-0.536240</td>
      <td>-0.536240</td>
      <td>59800.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>589</th>
      <td>1.046436</td>
      <td>0.649472</td>
      <td>-1.086311</td>
      <td>-0.810890</td>
      <td>-0.155834</td>
      <td>-0.238313</td>
      <td>1.484970</td>
      <td>0.181675</td>
      <td>-1.081457</td>
      <td>-0.069724</td>
      <td>...</td>
      <td>-0.531085</td>
      <td>-0.536240</td>
      <td>-0.533838</td>
      <td>-0.534374</td>
      <td>-0.534610</td>
      <td>-0.536240</td>
      <td>-0.536240</td>
      <td>59900.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
<p>590 rows × 1338 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_reader</span><span class="o">.</span><span class="n">_get_target_ch</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&#39;MOV_LEFT_CLEAN&#39;
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_reader</span><span class="o">.</span><span class="n">plot_target_averaged_channel</span><span class="p">(</span>
    <span class="n">ch</span><span class="o">=</span><span class="s2">&quot;ECOG_RIGHT_0&quot;</span><span class="p">,</span>
    <span class="n">list_feature_keywords</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">epoch_len</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">threshold</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
    <span class="n">ytick_labelsize</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span>
    <span class="n">figsize_x</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
    <span class="n">figsize_y</span><span class="o">=</span><span class="mi">12</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Feature epoch average figure saved to: /Users/hi/Documents/py_neuromodulation/examples/data/derivatives/sub-000_ses-right_task-force_run-3/MOV_aligned_features_ch_ECOG_RIGHT_0_all.png
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_BIDS_13_1.png" src="_images/example_BIDS_13_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">feature_reader</span><span class="o">.</span><span class="n">plot_all_features</span><span class="p">(</span>
    <span class="n">ytick_labelsize</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">clim_low</span><span class="o">=-</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">clim_high</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">ch_used</span><span class="o">=</span><span class="s2">&quot;ECOG_RIGHT_0&quot;</span><span class="p">,</span>
    <span class="n">time_limit_low_s</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">time_limit_high_s</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span>
    <span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">save</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_BIDS_14_0.png" src="_images/example_BIDS_14_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nm_plots</span><span class="o">.</span><span class="n">plot_corr_matrix</span><span class="p">(</span>
    <span class="n">feature</span> <span class="o">=</span> <span class="n">feature_reader</span><span class="o">.</span><span class="n">feature_arr</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;ECOG_RIGHT_0&#39;</span><span class="p">),</span>
    <span class="n">ch_name</span><span class="o">=</span> <span class="s1">&#39;ECOG_RIGHT_0-avgref&#39;</span><span class="p">,</span>
    <span class="n">feature_names</span><span class="o">=</span><span class="n">feature_reader</span><span class="o">.</span><span class="n">feature_arr</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="s1">&#39;ECOG_RIGHT_0-avgref&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="n">feature_file</span><span class="o">=</span><span class="n">feature_reader</span><span class="o">.</span><span class="n">feature_file</span><span class="p">,</span>
    <span class="n">show_plot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">15</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
&lt;AxesSubplot:title={&#39;center&#39;:&#39;Correlation matrix features channel: ECOG_RIGHT_0-avgref&#39;}&gt;
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_BIDS_15_1.png" src="_images/example_BIDS_15_1.png" />
</div>
</div>
</section>
<section id="Decoding">
<h2>Decoding<a class="headerlink" href="#Decoding" title="Permalink to this heading"></a></h2>
<p>The main focus of the py_neuromodulation pipeline is the feature estimation. Nevertheless, the user can also use the pipeline for Machine Learning decoding. It can be used for regression and classification problems, and also using unsupervised methods, such as PCA and CCA.</p>
<p>Here we show an example using the XGBOOST Classifier. The labels used come from the continuous grip force movement target, namedd “MOV_LEFT_CLEAN”.</p>
<p>First we initialize the <em>nm_decode.Decoder</em> class, which the specified <em>validation method</em>, here being a simple 3-fold cross validation, the evaluation metric, the used machine learning model, and the used channels we want to evaluate performances for.</p>
<p>There are are many more implemented methods, but we will here limit here to the ones presented.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[89]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">linear_model</span><span class="o">.</span><span class="n">LinearRegression</span><span class="p">()</span>

<span class="n">feature_reader</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">nm_decode</span><span class="o">.</span><span class="n">Decoder</span><span class="p">(</span>
    <span class="n">features</span><span class="o">=</span><span class="n">feature_reader</span><span class="o">.</span><span class="n">feature_arr</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="n">feature_reader</span><span class="o">.</span><span class="n">label</span><span class="p">,</span>
    <span class="n">label_name</span><span class="o">=</span><span class="n">feature_reader</span><span class="o">.</span><span class="n">label_name</span><span class="p">,</span>
    <span class="n">used_chs</span><span class="o">=</span><span class="n">feature_reader</span><span class="o">.</span><span class="n">used_chs</span><span class="p">,</span>
    <span class="n">model</span><span class="o">=</span><span class="n">model</span><span class="p">,</span>
    <span class="n">eval_method</span><span class="o">=</span><span class="n">metrics</span><span class="o">.</span><span class="n">r2_score</span><span class="p">,</span>
    <span class="n">cv_method</span><span class="o">=</span><span class="n">model_selection</span><span class="o">.</span><span class="n">KFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[90]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">performances</span> <span class="o">=</span> <span class="n">feature_reader</span><span class="o">.</span><span class="n">run_ML_model</span><span class="p">(</span>
    <span class="n">estimate_channels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">estimate_gridpoints</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="n">estimate_all_channels_combined</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">save_results</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
model being saved to: C:\code\py_neuromodulation\examples\data\derivatives\sub-000_ses-right_task-force_run-3\sub-000_ses-right_task-force_run-3_LM_ML_RES.p
</pre></div></div>
</div>
<p>The performances is a dictionary, that we will now transform into a dataframe:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df_per</span> <span class="o">=</span> <span class="n">feature_reader</span><span class="o">.</span><span class="n">get_dataframe_performances</span><span class="p">(</span><span class="n">performances</span><span class="p">)</span>

<span class="n">df_per</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[91]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>performance_test</th>
      <th>performance_train</th>
      <th>sub</th>
      <th>ch</th>
      <th>ch_type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.187735</td>
      <td>0.613152</td>
      <td>000</td>
      <td>LFP_RIGHT_0-LFP_RIGHT_2</td>
      <td>electrode ch</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.446129</td>
      <td>0.668467</td>
      <td>000</td>
      <td>LFP_RIGHT_1-LFP_RIGHT_0</td>
      <td>electrode ch</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.261070</td>
      <td>0.608497</td>
      <td>000</td>
      <td>LFP_RIGHT_2-LFP_RIGHT_1</td>
      <td>electrode ch</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.398090</td>
      <td>0.713984</td>
      <td>000</td>
      <td>ECOG_RIGHT_0-avgref</td>
      <td>electrode ch</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.480724</td>
      <td>0.652312</td>
      <td>000</td>
      <td>ECOG_RIGHT_1-avgref</td>
      <td>electrode ch</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.313613</td>
      <td>0.638253</td>
      <td>000</td>
      <td>ECOG_RIGHT_2-avgref</td>
      <td>electrode ch</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0.157768</td>
      <td>0.641390</td>
      <td>000</td>
      <td>ECOG_RIGHT_3-avgref</td>
      <td>electrode ch</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.330807</td>
      <td>0.588431</td>
      <td>000</td>
      <td>ECOG_RIGHT_4-avgref</td>
      <td>electrode ch</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.202398</td>
      <td>0.591196</td>
      <td>000</td>
      <td>ECOG_RIGHT_5-avgref</td>
      <td>electrode ch</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0.000000</td>
      <td>1.000000</td>
      <td>000</td>
      <td>all_ch_combined</td>
      <td>all ch combinded</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax</span> <span class="o">=</span> <span class="n">nm_plots</span><span class="o">.</span><span class="n">plot_df_subjects</span><span class="p">(</span>
    <span class="n">df_per</span><span class="p">,</span> <span class="n">x_col</span><span class="o">=</span><span class="s2">&quot;sub&quot;</span><span class="p">,</span> <span class="n">y_col</span><span class="o">=</span><span class="s2">&quot;performance_test&quot;</span><span class="p">,</span> <span class="n">hue</span><span class="o">=</span><span class="s2">&quot;ch_type&quot;</span><span class="p">,</span>
    <span class="n">PATH_SAVE</span><span class="o">=</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_OUT</span><span class="p">,</span> <span class="n">RUN_NAME</span><span class="p">,</span> <span class="n">RUN_NAME</span> <span class="o">+</span> <span class="s2">&quot;_decoding_performance.png&quot;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$R^2$ Correlation&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Subject 000&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Performance comparison Movement decoding&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[98]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Text(0.5, 1.0, &#39;Performance comparison Movement decoding&#39;)
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/example_BIDS_21_1.png" src="_images/example_BIDS_21_1.png" />
</div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="first_demo.html" class="btn btn-neutral float-left" title="First Demo" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="param.html" class="btn btn-neutral float-right" title="ParametrizationDefinition" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2021, Timon Merk.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>